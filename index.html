<!DOCTYPE html><!--

Simulacra.js
https://github.com/0x8890/simulacra

--><meta charset="utf-8"><title>Simulacra.js</title><meta name="description" content="One-way data binding for web applications."><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="index.css"><link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIXx/1Ix7fr/////////////////Me36/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABTR//8o7v3//P////3///////////////////8x7fr/Me36/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABS3/f8N4f7/J+79/+f8/f/t/f7/8v7///X+///6////Lu77/zDu+/8J5P//AAAAAAAAAAAAAAAAAAAAAESx+vwapPr/E9P+/xLq/v+/9/3/F+z9/9H5/f/a+/7/4vv9/w3m/v8P6f7/E87//xLS/v8AAAAAAAAAAAAAAAAAAAAAHpT3/xTF//8J5f//Cub+/5Tz+/+g9Pz/q/b8/xLq/v8Q2f7/Dd3+/xW8/f+d3/+FAAAAAAAAAAAAAAAAAAAAAB+H9v8Vtf3/DN7//wzf/v9L7vr/Xe/6/wXj//8J5f//EMz//xTP/v8UyP7/Gar7/wAAAAAAAAAAAAAAAAAAAAAgfvX/Gqb6/xix+/8Yrfv/Me36/zHt+v8N3f7/DN7//xW9/v8UwP7/HZX4/xyZ+P8AAAAAAAAAAAAAAAAAAAAAIXf0/x2X+P8dlvf/HJ35/xDU/v8N1f7/DNf+/xmp+/8Yrfv/H4b2/x6P9/8AAAAAAAAAAAAAAAAAAAAAAAAAACFx8/8fiPb/IIH1/x6N9/8Szv//Es/+/xLR//8cm/n/IHz0/5TC/A0gfvX/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIWvz/yFt8/8gfvX/E8j//xDJ//8fiPb/H4v2/yF19P8AAAAAGHTz/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKnG+2kiZfL/IH71/xTF//8Vxf//IH71/yFt8/8hbvP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACB/9f8gfvX/IHz1/yB+9f8iZvL/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkVOr/IH71/yB+9f8kXPH/JF7x/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZF3/8ggPb/JUzk/yVP5v8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJzXU/yc52P8mPdv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACmuOsSJyvM/wAAAAAAAAAAAAAAAAAAAAAAAAAA/B8AAPAHAADgAwAAwAEAAOABAADgAQAA4AEAAOADAADgCwAA8AsAAPgPAAD8HwAA/B8AAP4fAAD/HwAA/98AAA==" rel="icon" type="image/x-icon"><script src="simulacra.min.js"></script><header><h1>Simulacra.js</h1><h2>One-way data binding for web applications.</h2><code>npm install simulacra --save</code> <a href="simulacra.min.js" class="button">Download (v0.1.2)</a> <a href="https://github.com/0x8890/simulacra" id="corner"><span>Fork on</span> GitHub</a></header><div class="example"><div class="container"><div class="left"><div class="product-container"></div></div><div class="right"><code>Some things to try:</code><ul><li><code>data.name = "Caramel Latte"</code></li><li><code>data.details.size.push("Trenta")</code></li></ul><input type="text" name="eval" placeholder="Change data..." autofocus></div></div></div><article><h2 id="usage">Usage<a class="anchor" href="#usage" title="Link to this section “Usage”">#</a></h2><p>Simulacra.js uses plain old HTML with nothing that is coupled with implementation for templating. Here&#39;s a sample template, note that it&#39;s just a <code>&lt;template&gt;</code> tag without any data-binding attributes:</p><pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">template</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"product"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"name"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"details"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"size"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">h4</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"vendor"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h4</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">template</span>&gt;</span>
</code></pre><p>Using the <code>&lt;template&gt;</code> tag is optional but optimal since its contents are not rendered by default, but any DOM element will suffice. In the above template, there are no iteration mechanisms, because Simulacra.js will automatically clone DOM elements based on the data. Here&#39;s some sample data:</p><pre><code class="lang-js"><span class="hljs-title">var</span> <span class="hljs-typedef"><span class="hljs-keyword">data</span> = <span class="hljs-container">{
  <span class="hljs-title">name</span>: '<span class="hljs-type">Pumpkin</span> <span class="hljs-type">Spice</span> <span class="hljs-type">Latte</span>',
  <span class="hljs-title">details</span>: {
    <span class="hljs-title">size</span>: [ '<span class="hljs-type">Tall</span>', '<span class="hljs-type">Grande</span>', '<span class="hljs-type">Venti</span>' ],
    <span class="hljs-title">vendor</span>: '<span class="hljs-type">Starbucks</span>'
  }</span></span>
}
</code></pre><p>Simulacra.js exports only a single function, which does different things based on the types of the arguments. There are three use cases: defining mount &amp; unmount functions for an element, defining nested bindings for an element, and defining a binding for a data object.</p><pre><code class="lang-js"><span class="hljs-keyword">var</span> bind = <span class="hljs-built_in">require</span>(<span class="hljs-string">'simulacra'</span>) <span class="hljs-comment">// or `window.simulacra`</span>

<span class="hljs-comment">// Simulacra.js accepts DOM Nodes, the `$` function is just an alias for</span>
<span class="hljs-comment">// `querySelector` which is a convenient way to select them.</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">$</span> (<span class="hljs-params">selector</span>) </span>{ <span class="hljs-keyword">return</span> fragment.querySelector(selector) }

<span class="hljs-keyword">var</span> fragment = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'product'</span>).content
<span class="hljs-keyword">var</span> bindings = bind(fragment, {
  name: bind($(<span class="hljs-string">'.name'</span>)),
  details: bind($(<span class="hljs-string">'.details'</span>), {
    size: bind($(<span class="hljs-string">'.size'</span>)),
    vendor: bind($(<span class="hljs-string">'.vendor'</span>))
  })
})

<span class="hljs-built_in">document</span>.body.appendChild(bind(data, bindings))
</code></pre><p>The DOM will update if any of the bound keys are assigned.</p><p>All mount functions are &quot;offline&quot; operations, they mutate elements which exist only in memory. By default, the value will be assigned to the element&#39;s <code>textContent</code> property (or <code>value</code> or <code>checked</code> for inputs), additional functions for mounting and unmounting may be used for arbitrary element manipulation.</p><p>The mount &amp; unmount functions are passed in as the second and third arguments respectively, and have the signature (<code>node</code>, <code>value</code>, <code>oldValue</code>, <code>index</code>). For example, to manipulate a node before mounting it, one may do this:</p><pre><code class="lang-js">bind($('.name'), function (<span class="hljs-keyword">node</span><span class="hljs-identifier"></span><span class="hljs-title">, value</span>) {
  <span class="hljs-keyword">node</span>.<span class="hljs-identifier"></span><span class="hljs-title">textContent</span> = 'Hi ' + value + '!'
})
</code></pre><p>The mount function gets run before a node is replaced, and the unmount function gets run before a node is removed. If there is no return value, then it&#39;s assumed that the specified node will be appended. It&#39;s possible to return a different node in the mount function, which enables heterogeneous collections.</p><h2 id="benchmarks">Benchmarks<a class="anchor" href="#benchmarks" title="Link to this section “Benchmarks”">#</a></h2><p>Simulacra.js is even faster than consecutively setting the <code>innerHTML</code> property. Based on the <a href="https://lhorie.github.io/mithril/benchmarks.html">benchmarks</a> from Mithril.js, here&#39;s how it compares. Tests ran on a mid-2014 Macbook Pro using Chrome 46. All times are rounded to the nearest millisecond.</p><div class="table-wrapper"><table><thead><tr><th style="text-align:left">Name</th><th style="text-align:left">Loading</th><th style="text-align:left">Scripting</th><th style="text-align:left">Rendering</th><th style="text-align:left">Painting</th><th style="text-align:left">Other</th></tr></thead><tbody><tr><td style="text-align:left">Simulacra.js</td><td style="text-align:left">1 ms</td><td style="text-align:left">12 ms</td><td style="text-align:left">6 ms</td><td style="text-align:left">24 ms</td><td style="text-align:left">8 ms</td></tr><tr><td style="text-align:left"><em>innerHTML</em></td><td style="text-align:left">35 ms</td><td style="text-align:left">32 ms</td><td style="text-align:left">5 ms</td><td style="text-align:left">24 ms</td><td style="text-align:left">10 ms</td></tr><tr><td style="text-align:left">Mithril.js</td><td style="text-align:left">7 ms</td><td style="text-align:left">69 ms</td><td style="text-align:left">17 ms</td><td style="text-align:left">25 ms</td><td style="text-align:left">19 ms</td></tr><tr><td style="text-align:left">jQuery</td><td style="text-align:left">11 ms</td><td style="text-align:left">101 ms</td><td style="text-align:left">17 ms</td><td style="text-align:left">25 ms</td><td style="text-align:left">23 ms</td></tr><tr><td style="text-align:left">React.js</td><td style="text-align:left">8 ms</td><td style="text-align:left">109 ms</td><td style="text-align:left">15 ms</td><td style="text-align:left">26 ms</td><td style="text-align:left">22 ms</td></tr><tr><td style="text-align:left">Angular.js</td><td style="text-align:left">8 ms</td><td style="text-align:left">115 ms</td><td style="text-align:left">15 ms</td><td style="text-align:left">28 ms</td><td style="text-align:left">26 ms</td></tr></tbody></table></div><p>To run the benchmarks, you will have to clone the repository and build it by running <code>npm run build</code>. The benchmarks are located <a href="https://github.com/0x8890/simulacra/tree/master/benchmark">here</a>.</p><h2 id="how-it-works">How it Works<a class="anchor" href="#how-it-works" title="Link to this section “How it Works”">#</a></h2><p>On initialization, Simulacra.js removes bound elements from the document and replaces them with a empty text node (marker) for memoizing its position. Based on a value in the bound data object, it clones template elements and applies the mount function on the cloned elements, and appends them near the marker or adjacent nodes.</p><p>When a bound key is assigned, it gets internally casted into an array if it is not an array already, and the values of the array are compared with previous values. Based on whether a value at an index has changed, Simulacra.js will unmount and mount a DOM Node corresponding to the value. This is faster and simpler than diffing changes between DOM trees, and performing DOM operations on &quot;offline&quot; nodes (not in the live tree) is faster than modifying live nodes.</p><h2 id="caveats">Caveats<a class="anchor" href="#caveats" title="Link to this section “Caveats”">#</a></h2><ul><li>The <code>delete</code> keyword will not trigger a DOM update, due to lack of reflection on this keyword.</li><li>Out-of-bounds array index assignment will not work, because the number of settters is equal to the length of the array.</li><li>The bound data object may not contain any getters &amp; setters of its own, since they will be overridden by Simulacra.js.</li></ul><h2 id="under-the-hood">Under the Hood<a class="anchor" href="#under-the-hood" title="Link to this section “Under the Hood”">#</a></h2><p>This library is written in ES5 syntactically, and makes use of:</p><ul><li>Object property getters &amp; setters (ES5)</li><li>WeakMap (ES6)</li><li>TreeWalker (DOM Level 2)</li><li>Node.isEqualNode (DOM Level 3)</li><li>Node.contains (DOM Living Standard)</li></ul><p>No shims are included. At the bare minimum, it works in IE9+ with a WeakMap polyfill.</p><h2 id="license">License<a class="anchor" href="#license" title="Link to this section “License”">#</a></h2><p>This software is licensed under the <a href="https://raw.githubusercontent.com/0x8890/simulacra/master/LICENSE">MIT license</a>.</p></article><template id="product"><h1 class="name"></h1><div class="details"><div><span class="size"></span></div><hr><h4 class="vendor"></h4></div></template><script type="text/javascript">(function () {
  window.data = {
    name: 'Pumpkin Spice Latte',
    details: {
      size: [ 'Tall', 'Grande', 'Venti' ],
      vendor: 'Starbucks'
    }
  }

  var bind = window.simulacra
  var fragment = document.getElementById('product').content
  function $ (s) { return fragment.querySelector(s) }

  var bindings = bind(fragment, {
    name: bind($('.name')),
    details: bind($('.details'), {
      size: bind($('.size')),
      vendor: bind($('.vendor'))
    })
  })

  var output = bind(data, bindings)
  document.querySelector('.product-container').appendChild(output)

  var input = document.querySelector('input[name="eval"]')
  input.addEventListener('keyup', function (event) {
    if (event.keyCode === 13) {
      var x = input.value
      input.value = ''
      eval(x)
    }
  })
}())</script>